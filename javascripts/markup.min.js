/*
  Markup.js v1.0: http://github.com/adammark/Markup.js
  (c) 2011 Adam Mark
*/
var Mark={includes:{},cache:{},_copy:function(d,c){c=c||[];for(var e in d){c[e]=d[e]}return c},_size:function(b){return b instanceof Array?b.length:b},_iter:function(a,b){this.idx=a;this.size=b;this.sign="#";this.prototype=Number;this.toString=this.valueOf=function(){return this.idx+this.sign.length-1}},_pipe:function(e,d){var c=d.shift(),b,a;if(c){b=c.split(">").shift().trim();a=c.split(">").splice(1);e=Mark._pipe(Mark.pipes[b].apply(null,[e].concat(a)),d)}return e},_bridge:function(g,e){var f="{{"+e+"([^/}]+\\w*)?}}|{{/"+e+"}}",l=new RegExp(f,"g"),n=g.match(l),m,k=0,j=0,i=-1,h=0;for(m in n){i=g.indexOf(n[m],i+1);if(n[m].match("{{/")){j++}else{k++}if(k===j){break}}k=g.indexOf(n[0]);j=k+n[0].length;h=i+n[m].length;return[g.substring(k,h),g.substring(j,i)]}};Mark.up=function(s,a,d,e){a=a||{};d=d||{};var m=/\{\{\w*[^}]+\w*\}\}/g,l=s.match(m)||[],o=Mark._pipe,t,c,g,h=[],r,b,f,n,k,p=0,j;if(d.pipes){Mark._copy(d.pipes,Mark.pipes)}if(d.includes){Mark._copy(d.includes,Mark.includes)}if(d.cache){Mark.cache[d.cache]=s}function q(i,w,v,u){w=Mark.up(w,v,u).split("{{else}}");if(b){i=w[i===false?1:0];i=Mark.up(i||"",v,u)}return i}while((t=l[p++])){k=e;f="";r=t.indexOf("/}}")>-1;c=t.substr(2,t.length-(r?5:4));b=c.indexOf("if ")===0;h=c.replace(/&gt;/g,">").split("|").splice(1);c=c.replace(/^if/,"").split("|").shift().trim();g=b?"if":c.split("|")[0];if(!r&&l.indexOf("{{/"+g+"}}")>-1){k=Mark._bridge(s,g);t=k[0];f=k[1];p+=t.match(m).length-1}if(Mark.includes[c]){c=Mark.includes[c];if(c instanceof Function){c=c()}k=o(Mark.up(c,a),h)}else{if(c==="."){k=q(o(a,h),f,a)}else{if(c.match(/#{1,2}/)){d.iter.sign=c;k=q(o(d.iter,h),f,a,d)}else{if(t==="{{else}}"){continue}else{if(c.match(/\./)){c=c.split(".");for(j=0,n=a;j<c.length;j++){n=n[c[j]]}k=q(o(n,h),f,a)}else{if(b){k=true;if(!h.length){if(!a[c]||a[c].length===0){k=false}}k=q(k&&o(a[c],h),f,a)}else{if(a[c] instanceof Array){k=n=o(a[c],h);if(n instanceof Array){k="";for(j in n){d={iter:new Mark._iter(+j,n.length)};k+=f?Mark.up(f,n[j],d):n[j]}}}else{if(f){k=a[c]?Mark.up(f,a[c]):e}else{if(a.hasOwnProperty(c)){k=o(a[c],h)}}}}}}}}}s=s.replace(t,k===e?"???":k)}return s};Mark.pipes={blank:function(b,a){return !!b||b===0?b:a},empty:function(a){return !a||(a+"").trim().length===0?a:false},notempty:function(a){return a&&(a+"").trim().length?a:false},more:function(d,c){return Mark._size(d)>c?d:false},less:function(d,c){return Mark._size(d)<c?d:false},ormore:function(d,c){return Mark._size(d)>=c?d:false},orless:function(d,c){return Mark._size(d)<=c?d:false},between:function(e,d,f){e=Mark._size(e);return e>=d&&e<=f?e:false},equals:function(d,c){return d==c?d:false},notequals:function(d,c){return d!=c?d:false},like:function(b,a){return new RegExp(a).test(b)?b:false},notlike:function(b,a){return !Mark.pipes.like(b,a)?b:false},upcase:function(a){return String(a).toUpperCase()},downcase:function(a){return String(a).toLowerCase()},chop:function(a,b){return a.length>b?a.substr(0,b)+"...":a},trim:function(a){return a.trim()},pack:function(a){return a.trim().replace(/\s{2,}/g," ")},round:function(a){return Math.round(+a)},style:function(b,a){return'<span class="'+a+'">'+b+"</span>"},clean:function(a){return String(a).replace(/<\/?[^>]+>/gi,"")},sub:function(c,b,a){return String(c).replace(new RegExp(b,"g"),a)},size:function(a){return a.length},length:function(a){return a.length},reverse:function(a){return Mark._copy(a).reverse()},join:function(a,b){return a.join(b)},limit:function(a,b){return a.slice(0,b)},slice:function(a,c,b){return a.slice(+c,(+c)+(+b))},split:function(b,a){return b.split(a||",")},choose:function(b,c,a){return !!b?c:a},sort:function(a,c){var b=function(e,d){return e[c]>d[c]?1:-1};return Mark._copy(a).sort(c?b:undefined)},fix:function(a,b){return(+a).toFixed(b)},mod:function(a,b){return(+a)%(+b)},divisible:function(a,b){return a!==false&&a%b===0?a:false},even:function(a){return a!==false&&a%2===0?a:false},odd:function(a){return a!==false&&a%2===1?a:false},number:function(a){return parseFloat(a.replace(/[^\-\d\.]/g,""))},url:function(a){return encodeURI(a)},bool:function(a){return !!a},falsy:function(a){return !a},first:function(a){return a.idx===0},last:function(a){return a.idx===a.size-1},call:function(b,a){return b[a].apply(b,[].slice.call(arguments,2))}};